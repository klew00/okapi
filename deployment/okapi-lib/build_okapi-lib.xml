<?xml version="1.0"?> 
<project name="okapi-lib" default="all" basedir="."> 

	<property name="jarname" value="okapi-lib"/>
	<property name="platform" value="win32-x86"/>
 	<property name="tmp" value="tmp"/>
	<property name="dist" value="dist_${platform}"/>
	<property name="distlib" value="${dist}/lib"/>
 
	<condition property="is_win32-x86">
		<equals arg1="${platform}" arg2="win32-x86"/>
	</condition>
	<condition property="is_carbon-macosx">
		<equals arg1="${platform}" arg2="carbon-macosx"/>
	</condition>
	<condition property="is_gtk2-linux-x86">
		<equals arg1="${platform}" arg2="gtk2-linux-x86"/>
	</condition>
	<condition property="is_gtk2-linux-x86_64">
		<equals arg1="${platform}" arg2="gtk2-linux-x86_64"/>
	</condition>

	<condition property="is_windows_or_mac">
		<or>
			<equals arg1="${platform}" arg2="win32-x86"/>
			<equals arg1="${platform}" arg2="carbon-macosx"/>
		</or>
	</condition>
	
	<condition property="is_linux">
		<or>
			<equals arg1="${platform}" arg2="gtk2-linux-x86"/>
			<equals arg1="${platform}" arg2="gtk2-linux-x86_64"/>
		</or>
	</condition>

	<target name="init">
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${tmp}"/>
			<fileset dir="${dist}"/>
		</delete>
		<mkdir dir="${tmp}"/>
		<mkdir dir="${distlib}"/>
 	</target>

	<target name="compile" depends="init"> 
		<ant antfile="../shared/build_third-party.logger-slf4j.xml" inheritAll="true"/>
		<ant antfile="../shared/build_third-party.stax-wstx.xml" inheritAll="true"/>
		<copy file="../../third-party/${platform}/swt.jar" todir="${distlib}"/>
		
		<ant antfile="../shared/build_common.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.common.xml" inheritAll="true"/>
		<ant antfile="../shared/build_pipeline.xml" inheritAll="true"/>
		
		<ant antfile="../shared/build_filters.html.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.properties.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.po.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.regex.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.xml.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.xliff.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.idml.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.openoffice.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.openxml.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.rtf.xml" inheritAll="true"/>
		<ant antfile="../shared/build_filters.tmx.xml" inheritAll="true"/>

		<ant antfile="../shared/build_ui.common.xml" inheritAll="true"/>
		<ant antfile="../shared/build_ui.filters.common.xml" inheritAll="true"/>

		<ant antfile="../shared/build_ui.filters.properties.xml" inheritAll="true"/>
		<ant antfile="../shared/build_ui.filters.po.xml" inheritAll="true"/>
		<ant antfile="../shared/build_ui.filters.openoffice.xml" inheritAll="true"/>
		<ant antfile="../shared/build_ui.filters.regex.xml" inheritAll="true"/>

		<!-- DO NOT CHANGE WHITESPACES IN ATTRIBUTE VALUE 
		AND CHECK MANIFEST IN JAR IF YOU ADD/REMOVE JARs -->
		<manifest file="${tmp}/MANIFEST.MF">
			<attribute name="Class-Path" value="swt.jar slf4j-api-1.5.0.jar stax-api-1.0.1.jar 
          wstx-lgpl-3.2.8.jar jyaml-1.3.jar             
                      commons-logging-api-1.1.1.jar log4j-api-1.2.15.jar 
                 slf4j-jdk14-1.5.0.jar"/>
  		</manifest>

		<jar jarfile="${distlib}/${jarname}.jar" basedir="${tmp}" manifest="${tmp}/MANIFEST.MF"
			excludes="MANIFEST.MF"
  		/>

		<copy todir="${dist}/examples/java">
			<fileset dir="../../examples/java" />
		</copy>

		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${tmp}"/>
		</delete>
		
	</target>

	<target name="zipAll" if="is_windows_or_mac">
		<zip destfile="${dist}/${jarname}_${platform}.zip" basedir="${dist}"/>
	</target>

	<target name="gzipAll" if="is_linux">
		<tar destfile="${dist}/${jarname}_${platform}.tar.gz" basedir="${dist}" compression="gzip"/>
	</target>
	
	<target name="all" depends="compile, zipAll, gzipAll"/>

</project>
